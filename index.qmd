---
title: "DAFT Package Challenge"
subtitle: "Recreating the Scurvy DAGs with Beautiful Visualizations"
format:
  html: default
execute:
  echo: true
  eval: true
---

# ðŸŽ¨ DAFT Package Challenge - Recreating the Scurvy DAGs

::: {.callout-important}
## ðŸ“Š Challenge Requirements In Section [Student Analysis Section](#student-analysis-section)
- Recreate all three scurvy DAGs using DAFT programming
- Optional: Demonstrate understanding of DAFT customization options
:::

## The Story of Scurvy: A Data Science Tragedy

Scurvy was a devastating disease that affected sailors on long voyages. The cure was discovered in 1747, but due to a misunderstanding about the cause, the cure was lost for over 150 years. This story involves three different understandings of the data generating process, each represented by a Directed Acyclic Graph (DAG) created using the DAFT package.

The three different understandings were:

1. **1747 Understanding:** Lemons prevent scurvy (correct but incomplete!)
2. **Misguided Belief:** Acid kills bacteria that causes scurvy (wrong!)
3. **1928 Understanding:** Vitamin C prevents scurvy (the real mechanism)

## Environment Setup

First, let's install the DAFT package and set up our environment:

```{python}
#| label: setup-environment
#| echo: true
#| message: false
#| warning: false

# Install DAFT package (run this in terminal if not already installed)
# pip install 'daft-pgm'

import daft
import matplotlib.pyplot as plt
import numpy as np

# Set up plotting parameters for better quality
plt.rcParams['figure.dpi'] = 150
plt.rcParams['savefig.dpi'] = 300

print("DAFT package imported successfully!")
print("Ready to create beautiful DAGs!")
```

::: {.callout-note}
## ðŸ’¡ Understanding DAFT

**DAFT (Directed Acyclic Factor Graphs Toolkit)** is a Python package for creating probabilistic graphical models. It's particularly useful for:

- Creating Directed Acyclic Graphs (DAGs)
- Visualizing causal relationships
- Communicating data generating processes
- Creating publication-quality figures

**Key DAFT Concepts:**

- **Nodes:** Represent variables or factors
- **Edges:** Show relationships between variables
- **Plates:** Indicate repeated structures
- **Styling:** Customize colors, shapes, and formatting
:::

## The Three DAGs: The Evolution of Understanding

### DAG 1: The 1747 Understanding (Correct but Incomplete)

**Historical Context:** In 1747, James Lind discovered that lemons prevent scurvy through a controlled experiment. However, the understanding was incomplete - they knew lemons worked but not why.

```{python}
#| label: dag-1-1747
#| echo: true
#| fig-cap: "1747 Understanding: Lemons prevent scurvy (correct but incomplete)"

import daft
import matplotlib.pyplot as plt

pgm = daft.PGM(dpi=150, alternate_style="outer")

pgm.add_node("lemons", "Lemons" + r" $(X)$", 1, 2, aspect=3, scale=1.1,
             plot_params={
                 'facecolor': 'lightyellow', 
                 'edgecolor': 'orange', 
                 'linewidth': 2,
                 'alpha': 0.8,
             })

pgm.add_node("scurvy_prevention", "Scurvy\nPrevention" + r" $(Y)$", 3.25, 2, aspect=3, scale=1.1,
             plot_params={
                 'facecolor': 'lightgreen', 
                 'edgecolor': 'darkgreen', 
                 'linewidth': 2,
                 'alpha': 0.8,
             })

pgm.add_edge("lemons", "scurvy_prevention")

pgm.render()
```

### DAG 2: The Misguided Belief (Wrong Understanding)

**Historical Context:** Over time, people came to believe it was the acid in lemons that killed bacteria which was causing scurvy. This led to lemons being replaced by limes (cheaper but less Vitamin C) or just using acids like vinegar, causing scurvy to return.

```{python}
#| label: dag-2-misguided
#| echo: true
#| fig-cap: "Misguided Belief: Acid kills bacteria (wrong understanding)"

import daft
import matplotlib.pyplot as plt

pgm = daft.PGM(dpi=150, alternate_style="outer")

pgm.add_node("acid", "Acid" + r" $(X)$", 1, 2, aspect=3, scale=1.1,
             plot_params={
                 'facecolor': 'lightcoral', 
                 'edgecolor': 'darkred', 
                 'linewidth': 2,
                 'alpha': 0.8,
             })

pgm.add_node("bacteria_death", "Bacteria\nDeath" + r" $(Z)$", 3, 2, aspect=3, scale=1.1,
             plot_params={
                 'facecolor': 'lightpink', 
                 'edgecolor': 'crimson', 
                 'linewidth': 2,
                 'alpha': 0.8,
             })

pgm.add_node("scurvy_prevention", "Scurvy\nPrevention" + r" $(Y)$", 5, 2, aspect=3, scale=1.1,
             plot_params={
                 'facecolor': 'lightgreen', 
                 'edgecolor': 'darkgreen', 
                 'linewidth': 2,
                 'alpha': 0.8,
             })

pgm.add_edge("acid", "bacteria_death")
pgm.add_edge("bacteria_death", "scurvy_prevention")

pgm.render()
```

### DAG 3: The 1928 Understanding (Complete and Correct)

**Historical Context:** In 1928, the true mechanism was discovered - it was Vitamin C (ascorbic acid) that prevented scurvy. This complete understanding finally explained why lemons worked and why the acid theory was wrong.

```{python}
#| label: dag-3-1928
#| echo: true
#| fig-cap: "1928 Understanding: Vitamin C prevents scurvy (complete and correct)"

import daft
import matplotlib.pyplot as plt

pgm = daft.PGM(dpi=150, alternate_style="outer")

pgm.add_node("vitamin_c", "Vitamin C\n(Ascorbic Acid)" + r" $(X)$", 1, 2, aspect=3, scale=1.1, fontsize=8,
             plot_params={
                 'facecolor': 'lightblue', 
                 'edgecolor': 'darkblue', 
                 'linewidth': 2,
                 'alpha': 0.8,
             })

pgm.add_node("scurvy_prevention", "Scurvy\nPrevention" + r" $(Y)$", 3.25, 2, aspect=3, scale=1.1,
             plot_params={
                 'facecolor': 'lightgreen', 
                 'edgecolor': 'darkgreen', 
                 'linewidth': 2,
                 'alpha': 0.8,
             })

pgm.add_edge("vitamin_c", "scurvy_prevention")

pgm.render()
```
